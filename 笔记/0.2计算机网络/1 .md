https://app.yinxiang.com/fx/743af2df-4651-4097-8479-29b5639dca70



https://www.nowcoder.com/discuss/post/353159080753700864



### Web页面的请求过程

#### **简略版**：

URL 敲下之后，浏览器是想要生成一个 TCP 套接字，以向目标 HTTP 服务器请求资源。
为了生成 TCP 套接字，我们必须知道域名对应的 IP 地址；
为了知道域名的 IP 地址，我们必须先向 DNS 服务器发送 DNS 查询报文；
为了向 DNS 服务器发送 DNS 查询报文，需要知道默认网关的 MAC 地址。
为了知道其 MAC 地址，必须用 ARP 协议进行解析出下一跳，也就是默认网关的 MAC 地址。

拿到默认网关 MAC 地址后，会封装一个 DNS 查询报文，向 DNS 发送 查询请求。
DNS 服务器收到请求后，把查询结果放在 UDP 报文段中，返回给主机。

主机现在拿到了域名对应的 IP 地址，可以生成套接字，把套接字用于向 HTTP 服务器发送 HTTP GET 报文了。
而在生成 TCP 套接字之前，要进行三次握手的连接
1
2
3
连接之后，把 GET 请求封装在报文中，交付给 HTTP 服务器。
HTTP 服务器拿到请求报文后，返回对应的 Web 资源。
浏览器收到 HTTP 响应之后，抽取 Web 页面的内容进行渲染。

#### **巨tm详细版**：

应用层：URL 敲下之后，首先浏览器会生成一个 TCP 套接字，以向目标 HTTP 服务器请求资源。为了生成该套接字，需要知道该 URL 域名对应的 IP 地址。
应用层：而为了向 DNS 服务器发送请求，生成一个 DNS 查询报文，是 53 端口号的。
网络层：这个 DNS 数据报被放入一个目的地址为 DNS 服务器 IP 地址的 IP 数据报中。
IP 数据报被放入一个帧中，把帧发到默认的网关中，而为了知道网关的 MAC 地址，需要用 ARP 协议来把网关的 IP 解析为 MAC 地址。

直到了网关的 MAC 地址后，才可以继续 DNS 的解析过程。
网关路由器拿到 DNS 查询报文后，会根据报文转发给下一跳，直到到达 DNS 服务器。
到达 DNS 服务器后，DNS 在数据库中查询待解析的域名。
找到 DNS 记录后，发送 DNS 回答报文，放入 UDP 报文段中，转发回主机。

主机拿到了解析后的域名，也就是 IP 地址后，就能生成套接字，把套接字用于向 Web 服务器发送 HTTP GET 报文。
在生成 TCP 套接字之前，必须先与 HTTP 服务器进行三次握手来建立连接。
生成一个具有目的端口 80 的 TCP SYN 报文段，并向 HTTP 服务器发送该报文段。
HTTP 服务器收到该报文段之后，回复 TCP 的 SYN ACK 报文段，发回主机。
主机接收到 SYN ACK 之后，再次恢复一个 ACK 确认连接报文段到 HTTP 服务器。
三次连接建立完毕。
浏览器生成 HTTP GET 报文，并交付给 HTTP 服务器。
HTTP 服务器从 TCP 套接字读取 HTTP GET 报文，生成一个响应报文，把 Web 页面的内容放入报文主体中，返回给主机。
浏览器拿到响应报文后，抽取 Web 页面内容，渲染页面。

